
# install shared libs for haskell runtime

  sudo apt-get install ghc-dynamic

# build shared lib. this makes Test.so and Test_stub.h

ghc -dynamic -shared -fPIC -o libTest.so TestSharedLib.hs -lHSrts-ghc7.6.3

# use ghc to build and link ... for test purposes. also pass -v to
# this to figure out linker flags, etc. this produces a very smal
# executable. leaving out the "-dynamic" flag produces a bigger
# executable

  ghc -no-hs-main -dynamic TestSharedLib.hs TestFromC.c  -o test

# okay, linking with gcc ... we use the ghc -v command line (above)
# to figure out what libraries need to be linked to, then a bit
# of head-scratching test library reorderings and groupings to
# get a simplified command line. this produces a binary that
# is statically linked against the Haskell libraries (but dynamically
# linked against other system libs). could be tweaked to dynamically
# link.

  gcc -DDYNAMIC -c TestFromC.c -o TestFromC.o -I/usr/lib/ghc/include

gcc -o test TestFromC.o -L. -L/usr/lib/ghc/base-4.6.0.1 -L/usr/lib/ghc/integer-gmp-0.5.0.0 -L/usr/lib/ghc/ghc-prim-0.3.0.0 -L/usr/lib/ghc -lTest -lHSrts -lHSbase-4.6.0.1 -lHSghc-prim-0.3.0.0 -lHSinteger-gmp-0.5.0.0 -lffi -lm -lrt -ldl -lgmp -Wl,-rpath,'$ORIGIN' -Wl,-rpath,/usr/lib/ghc/integer-gmp-0.5.0.0 



libHSinteger-gmp-0.5.0.0-ghc7.6.3.so
libHSinteger-gmp-0.5.0.0-ghc7.6.3.so
 

